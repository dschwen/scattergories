<html>
<head>
<title>Sockettest</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
<script src="/socket.io/socket.io.js"></script>
<script src="/lib/jquery-1.7.min.js"></script>
<script src="/lib/jquery.event.drag-2.0.min.js"></script>
<script src="/lib/all.js"></script>
</head>
<body>

<div class="ccontain">
<div id="gamepad"></div>
</div>

<div id="log"></div>

<div id="login" class="ccontain" style="display:none">
  <div class="dark"></div>
  <div id="loginbox">
    <div id="#motd"></div>
    Please enter your name to join the game<br/>
    <input type="text"><button id="dologin">Join</button>
  </div>
</div>

<script>
  var l = document.location,
      socket = io.connect( l.protocol + '//' + l.host, {
        'reconnect': true,
        'reconnection delay': 500,
        'max reconnection attempts': 10
      });

      
  function keyenter(e) {
    console.log(e.target);
    socket.emit( 'update', { n: 0, word: '' } );
  }
  
  // hook up login box
  $('#loginbox>button').click(function(){
    // log in
    socket.emit( 'login', { name: $('#loginbox>input').val() } );
    $('#login').fadeOut(200);
  });

  // connection established
  socket.on( 'ready', All.group('init',function (data) {
    // add MOTD to the login box
    if( data.motd) {
      $('#motd').text(data.motd).show();
    }
    
    // display login prompt
    $('#login').fadeIn(200);
  }) );

  // receive countdown event
  socket.on( 'update', function (data) {
    console.log(data.n);
  } );

  // receive game start event
  socket.on( 'startgame', function (data) {
    console.log(data);
  } );

  // receive game start event
  socket.on( 'stopgame', function (data) {
    console.log(data);
  } );

  // user handling/info events
  socket.on( 'newuser', function (data) {
    $('#log').append( $('<div></div').text( 'user ' + data.name + ' joined the game' ) );
  } );
  socket.on( 'userleft', function (data) {
    $('#log').append( $('<div></div').text( 'user ' + data.name + ' left' ) );
  } );
  socket.on('disconnect', function () {
    $('#log').append( $('<div></div').text( "Disconnected :-(" ) );
    //socket.socket.connect( l.protocol + '//' + l.host );
  });
</script>
</body>
</html>
